<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Java">
    <meta name="keyword"  content="github">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        通过异常处理错误 - undefined
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> Java自习室 </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar">
            <img src="/img/hellojava.jpg" />
        </div>
        <div class="name">
            <i>chaoxz2</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archive">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-异常"><span class="toc-text">1. 异常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-捕获异常"><span class="toc-text">2. 捕获异常</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-try块"><span class="toc-text">1. try块</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-异常处理"><span class="toc-text">2. 异常处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-使用finally清理"><span class="toc-text">3. 使用finally清理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-finally用来做什么"><span class="toc-text">1. finally用来做什么</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-在return中使用finally"><span class="toc-text">2. 在return中使用finally</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-异常丢失"><span class="toc-text">3. 异常丢失</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-终止与恢复"><span class="toc-text">4. 终止与恢复</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-自定义异常"><span class="toc-text">3. 自定义异常</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-创建自定义异常"><span class="toc-text">1. 创建自定义异常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-异常与记录日志"><span class="toc-text">2. 异常与记录日志</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-异常说明"><span class="toc-text">4.异常说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-捕获所有异常"><span class="toc-text">5. 捕获所有异常</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-栈轨迹"><span class="toc-text">1. 栈轨迹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-重新抛出异常"><span class="toc-text">2.重新抛出异常</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-抛出原异常"><span class="toc-text">1. 抛出原异常</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-抛出新异常"><span class="toc-text">2.抛出新异常</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-异常链"><span class="toc-text">3. 异常链</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-Java标准异常"><span class="toc-text">6. Java标准异常</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-异常的限制"><span class="toc-text">7. 异常的限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-构造器"><span class="toc-text">8. 构造器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-异常匹配"><span class="toc-text">9. 异常匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-其他可选方式"><span class="toc-text">10. 其他可选方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-把异常传给控制台"><span class="toc-text">1. 把异常传给控制台</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-把“被检查的异常”转换为“不检查的异常”"><span class="toc-text">2. 把“被检查的异常”转换为“不检查的异常”</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-对于系统自带的异常类："><span class="toc-text">1. 对于系统自带的异常类：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-对于自定义的异常类，让它继承自RuntimeException-甚至可以省去try-catch。"><span class="toc-text">2. 对于自定义的异常类，让它继承自RuntimeException,甚至可以省去try-catch。</span></a></li></ol></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>
        <div class="index-about-mobile">
            <i> Java自习室 </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        通过异常处理错误
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2018-09-12 15:13:54</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#异常" title="异常">异常</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <h3 id="1-异常"><a href="#1-异常" class="headerlink" title="1. 异常"></a>1. 异常</h3><p>异常是阻止当前方法或作用域继续执行的问题。在当前环境下无法获取必要的信息来解决问题，所做的只能是从当前环境跳出，把问题提交给上一级环境。这就是抛出异常时发生的事。<br>当抛出异常后，有几件事随之发生：<br>    首先，将使用new在堆上创建异常对象；<br>    然后，<strong>当前执行路径被终止</strong>，并且从当前环境中弹出对异常对象的引用。此时异常处理机制接管程序，开始寻找一个恰当的地方（异常处理程序）将程序从错误中恢复，使程序换一种方式运行，或者继续运行下去。<br>异常最重要的方面之一就是如果发生问题，它们将不允许程序沿着其正常的路径继续走下去。异常允许我们强制程序停止运行，并告诉我们出现了什么问题，或者强制程序处理问题，回到稳定状态。</p>
<hr>
<h3 id="2-捕获异常"><a href="#2-捕获异常" class="headerlink" title="2. 捕获异常"></a>2. 捕获异常</h3><h4 id="1-try块"><a href="#1-try块" class="headerlink" title="1. try块"></a>1. try块</h4><p>如果在方法内部抛出异常，这个方法将在抛出异常的过程中结束，要是不希望方法就此结束，可以在方法内设置一个特殊的块来捕获异常。因为在这个块里尝试各种方法调用，所以称为try块，是跟在try关键字后的普通程序块。例如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> Exception();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="2-异常处理"><a href="#2-异常处理" class="headerlink" title="2. 异常处理"></a>2. 异常处理</h4><p>抛出的异常必须在某处的到处理，处理它的地方就是异常处理程序，针对每个要捕获的异常，要准备相应的异常处理程序。异常处理程序紧跟在try块后面，以关键字catch表示。例如:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> Exception();</span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">System.out.println(<span class="string">"Caught Exception: "</span>+e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>那么，异常处理程序就能处理try块中抛出的Exception及其子类异常，处理方式是输出“Caught Exception: ”和具体异常名称。</p>
<h4 id="3-使用finally清理"><a href="#3-使用finally清理" class="headerlink" title="3. 使用finally清理"></a>3. 使用finally清理</h4><p>对于一些代码，可能会希望无论try块中是否抛出异常，它们都能得到执行。为了达到这个效果，可以在异常处理程序之后加上finally子句。例如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	f();</span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line"> System.out.println(<span class="string">"Caught Exception: "</span>+e);</span><br><span class="line">&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line"> System.out.println(<span class="string">"Well Done!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果f()抛出Exception,异常被捕获，处理，然后执行finally内容，输出为：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Caught Exception: Exception</span><br><span class="line">Well Done!</span><br></pre></td></tr></table></figure></p>
<p>如果f()不抛出异常，异常处理程序不被调用，执行finally内容,输出为：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Well Done!</span><br></pre></td></tr></table></figure></p>
<p>即，无论try块是否抛出异常，finally子句都会被执行。<br><em>因为涉及break和continue时finally子句也会得到执行。所以把finally子句和带标签的break和continue配合使用，可以取代goto。</em></p>
<h5 id="1-finally用来做什么"><a href="#1-finally用来做什么" class="headerlink" title="1. finally用来做什么"></a>1. finally用来做什么</h5><p>当要把除内存之外的资源恢复到它们的初始状态时，就需要用到finally子句。这种需要清理的资源可以是：已经打开的文件或者网络连接，在屏幕上画的图形，甚至可以是外部世界的某个开关。<a href="https://github.com/chaoxz2/Thinking-in-Java-4th-/blob/master/exercise/%E9%80%9A%E8%BF%87%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF/Switch.java">示例1</a>更好的<a href="https://github.com/chaoxz2/Thinking-in-Java-4th-/blob/master/exercise/%E9%80%9A%E8%BF%87%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF/WithFinally.java">示例2</a>，<a href="https://github.com/chaoxz2/Thinking-in-Java-4th-/blob/master/exercise/%E9%80%9A%E8%BF%87%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF/AlwaysFinally.java">示例3</a>。</p>
<h5 id="2-在return中使用finally"><a href="#2-在return中使用finally" class="headerlink" title="2. 在return中使用finally"></a>2. 在return中使用finally</h5><p>因为finally子句总是会执行的，所以在一个方法中，可以从多个点返回，并且可以保证重要的清理工作依旧会执行。<a href="https://github.com/chaoxz2/Thinking-in-Java-4th-/blob/master/exercise/%E9%80%9A%E8%BF%87%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF/MultipleReturns.java">示例</a></p>
<h5 id="3-异常丢失"><a href="#3-异常丢失" class="headerlink" title="3. 异常丢失"></a>3. 异常丢失</h5><p>用某些特殊的方法使用finally子句，就会出现异常被忽略的情况。</p>
<ul>
<li>未处理抛出的错误就在fnally子句里抛出新的异常<h4 id="4-终止与恢复"><a href="#4-终止与恢复" class="headerlink" title="4. 终止与恢复"></a>4. 终止与恢复</h4>异常处理理论上有两种模型，一种是终止模型，一旦异常被抛出，不能回来继续执行；一种是恢复模型，异常处理程序修正错误，重新调用出问题的方法。Java支持终止模型，要想让Java实现类似恢复行为，那么在遇见错误时就不能抛出异常，而是调用方法来修正错误。或者把try块放进while循环里，不断进入try块直到得到满意的结果。例如：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> counter;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">			<span class="keyword">try</span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(counter++==<span class="number">0</span>)</span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> Exception();</span><br><span class="line">				System.out.println(<span class="string">"No Exception"</span>);</span><br><span class="line">			&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">				System.out.println(<span class="string">"Exception"</span>);</span><br><span class="line">			&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">				System.out.println(<span class="string">"In finally clause"</span>);</span><br><span class="line">				<span class="keyword">if</span>(counter==<span class="number">3</span>)</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;<span class="comment">/*Output:</span></span><br><span class="line"><span class="comment">Exception</span></span><br><span class="line"><span class="comment">In finally clause</span></span><br><span class="line"><span class="comment">No Exception</span></span><br><span class="line"><span class="comment">In finally clause</span></span><br><span class="line"><span class="comment">No Exception</span></span><br><span class="line"><span class="comment">In finally clause</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="3-自定义异常"><a href="#3-自定义异常" class="headerlink" title="3. 自定义异常"></a>3. 自定义异常</h3><h4 id="1-创建自定义异常"><a href="#1-创建自定义异常" class="headerlink" title="1. 创建自定义异常"></a>1. 创建自定义异常</h4><p>可以创建自定义异常来表示程序可能遇到的特定异常。但是新异常类型<strong>必须从已有的异常类继承</strong>，最好选择意思相近的异常类继承。<br>-System.out和System.err:<br>System.err将错误发送至标准错误流，不会被重定向；<br>System.out也许会被重定向。</p>
<p>-printStackTrace():打印“从方法调用处直到异常抛出处”的方法调用序列；</p>
<h4 id="2-异常与记录日志"><a href="#2-异常与记录日志" class="headerlink" title="2. 异常与记录日志"></a>2. 异常与记录日志</h4><p>通过添加或调用如下方法记录程序异常日志：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.logging.*;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Loggerlogger=Logger.getLogger(<span class="string">"LoggingException"</span>);</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LoggingException</span><span class="params">()</span></span>&#123;</span><br><span class="line">	StringWriter trace=<span class="keyword">new</span> StringWriter();</span><br><span class="line">	printStackTrace(<span class="keyword">new</span> PrintWriter(trace));</span><br><span class="line">	logger.severe(trace.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>例如，要让程序记录自身的异常日志,就需要在定义异常类的时候添加它：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.logging.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoggingException</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Logger logger=Logger.getLogger(<span class="string">"LoggingException"</span>);</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LoggingException</span><span class="params">()</span></span>&#123;</span><br><span class="line">		StringWriter trace=<span class="keyword">new</span> StringWriter();</span><br><span class="line">		printStackTrace(<span class="keyword">new</span> PrintWriter(trace));</span><br><span class="line">		logger.severe(trace.toString());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoggingExceptions</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> LoggingException();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(LoggingException e)&#123;</span><br><span class="line">			System.err.println(<span class="string">"Caught "</span>+e);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> LoggingException();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(LoggingException e)&#123;</span><br><span class="line">			System.err.println(<span class="string">"Caught "</span>+e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;<span class="comment">/*Output:</span></span><br><span class="line"><span class="comment">9月 13, 2018 10:49:29 上午 LoggingException &lt;init&gt;</span></span><br><span class="line"><span class="comment">严重: LoggingException</span></span><br><span class="line"><span class="comment">        at LoggingExceptions.main(LoggingExceptions.java:16)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Caught LoggingException</span></span><br><span class="line"><span class="comment">9月 13, 2018 10:49:29 上午 LoggingException &lt;init&gt;</span></span><br><span class="line"><span class="comment">严重: LoggingException</span></span><br><span class="line"><span class="comment">        at LoggingExceptions.main(LoggingExceptions.java:21)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Caught LoggingException</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>假如假如要捕获已有的代码的异常，就需要在异常处理中生成日志消息：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.logging.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoggingExceptions2</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Logger logger=Logger.getLogger(<span class="string">"LoggerExceptions2"</span>);</span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">logException</span><span class="params">(Exception e)</span></span>&#123;</span><br><span class="line">		StringWriter trace=<span class="keyword">new</span> StringWriter();</span><br><span class="line">		e.printStackTrace(<span class="keyword">new</span> PrintWriter(trace));</span><br><span class="line">		logger.severe(trace.toString());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(NullPointerException e)&#123;</span><br><span class="line">			logException(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;<span class="comment">/*Output:</span></span><br><span class="line"><span class="comment">9月 13, 2018 10:53:21 上午 LoggingExceptions2 logException</span></span><br><span class="line"><span class="comment">严重: java.lang.NullPointerException</span></span><br><span class="line"><span class="comment">        at LoggingExceptions2.main(LoggingExceptions2.java:13)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p> 核心就是在异常处理程序中调用一个方法，以异常为参数，输出日志。（不同于上一个例子，<code>static void logException(Exception e)</code>这里是以异常为参数的。）<br><a href="https://github.com/chaoxz2/Thinking-in-Java-4th-/blob/master/exercise/%E9%80%9A%E8%BF%87%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF/ExtraFeatures.java">教材示例</a></p>
<hr>
<h3 id="4-异常说明"><a href="#4-异常说明" class="headerlink" title="4.异常说明"></a>4.异常说明</h3><p>异常说明使用了关键字throws，后面接一个所有潜在异常类型的列表。看起来像这样：<code>void f() throws MyExceptionA,MyExceptionB{}</code>如果没有异常说明如<code>void f(){}</code>就不能抛出任何异常(只有RuntimeException及其子类可以被抛出)。<br>可以声明方法将抛出异常，但实际并不抛出。</p>
<hr>
<h3 id="5-捕获所有异常"><a href="#5-捕获所有异常" class="headerlink" title="5. 捕获所有异常"></a>5. 捕获所有异常</h3><p>可以只写一个异常处理程序来捕获所有异常，通过捕获异常类型的基类Exception就可以做到这一点。（最好放在处理程序列表的列尾，防止它抢在其他异常处理程序之前将异常捕获，得不到更加准确的关于异常的信息和处理）</p>
<h4 id="1-栈轨迹"><a href="#1-栈轨迹" class="headerlink" title="1. 栈轨迹"></a>1. 栈轨迹</h4><p>printStackTrace()提供的信息可以供getStackTrace()访问，这个方法将返回一个由栈轨迹中的元素（StackTraceElement）组成的数组，每一个元素都表示栈中的一帧。元素0是栈顶元素，并且是调用序列中的最后一个方法调用（这个Throwable被创建和抛出之处）。数组中最后一个元素和栈底是调用序列中的第一个方法调用。例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> Exception();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">			<span class="keyword">for</span>(StackTraceElement ste:e.getStackTrace())</span><br><span class="line">				System.out.println(ste.getMethodName());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">g</span><span class="params">()</span></span>&#123;</span><br><span class="line">		f();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">h</span><span class="params">()</span></span>&#123;</span><br><span class="line">		g();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		h();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;<span class="comment">/*Output:</span></span><br><span class="line"><span class="comment">f</span></span><br><span class="line"><span class="comment">g</span></span><br><span class="line"><span class="comment">h</span></span><br><span class="line"><span class="comment">main</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p><a href="https://github.com/chaoxz2/Thinking-in-Java-4th-/blob/master/exercise/%E9%80%9A%E8%BF%87%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF/WhoCalled.java">教材示例</a></p>
<h4 id="2-重新抛出异常"><a href="#2-重新抛出异常" class="headerlink" title="2.重新抛出异常"></a>2.重新抛出异常</h4><h5 id="1-抛出原异常"><a href="#1-抛出原异常" class="headerlink" title="1. 抛出原异常"></a>1. 抛出原异常</h5><p>重新抛出异常会把异常抛给上一级环境中的异常处理程序，同一个try块的后续catch子句将被忽略。此外，异常对象的所有信息都将得以保持，所以高一级捕获此异常的的异常处理程序可以从这个异常对象中得到所有信息。如果只是把当前异常对象重新抛出，printStackTrace()显示的是原来异常抛出点的调用栈信息，并非重新抛出点的信息。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">	System.out.println(<span class="string">"Anexception was thrown"</span>);</span><br><span class="line">	<span class="keyword">throw</span> e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>要想更新这个信息，可以调用fillInStackTrace()，将返回一个Throwable对象，把当前调用栈信息填入原来的异常对象而建立。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">	System.out.println(<span class="string">"Anexception was thrown"</span>);</span><br><span class="line">	<span class="keyword">throw</span> (Exception)e.fillInStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><a href="https://github.com/chaoxz2/Thinking-in-Java-4th-/blob/master/exercise/%E9%80%9A%E8%BF%87%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF/Rethrowing.java">教材示例</a></p>
<h5 id="2-抛出新异常"><a href="#2-抛出新异常" class="headerlink" title="2.抛出新异常"></a>2.抛出新异常</h5><p>在捕获一场之后抛出新异常得到的效果类似于使用fillInStackTrace()，有关原异常点的信息会丢失，剩下的是与新抛出点有关的信息。<a href="https://github.com/chaoxz2/Thinking-in-Java-4th-/blob/master/exercise/%E9%80%9A%E8%BF%87%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF/RethrowNew.java">教材示例</a></p>
<h5 id="3-异常链"><a href="#3-异常链" class="headerlink" title="3. 异常链"></a>3. 异常链</h5><p>常常会想要在捕获一个异常后抛出另一个异常，并希望把原始的异常信息保存下来，这被称为异常链。现在所有的Throwable子类在构造器中都能接受一个cause对象作为参数。这个cause就用来表示原始异常，这样通过原始异常传递给新的异常，使得即使在当前位置创建并抛出了新的异常，也能通过这个异常链追踪到异常最初的发生位置。<br>在Throwable子类中，只有三种基本的异常类提供了带cause参数的构造器，它们是Error、Exception和RuntimeException。如果要把其他类型的异常链接起来，应该使用initCause()方法而不是构造器。<a href="https://github.com/chaoxz2/Thinking-in-Java-4th-/blob/master/exercise/%E9%80%9A%E8%BF%87%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF/DynamicFields.java">教材示例</a><br>简单示例如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test234</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="keyword">try</span>&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> Exception();</span><br><span class="line">			&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">				System.out.println(<span class="string">"Caught: "</span>+e);</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">catch</span>(RuntimeException ee)&#123;</span><br><span class="line">			System.out.println(<span class="string">"Caught: "</span>+ee);</span><br><span class="line">			ee.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;<span class="comment">/*Output:</span></span><br><span class="line"><span class="comment">Caught: java.lang.Exception</span></span><br><span class="line"><span class="comment">java.lang.Exception</span></span><br><span class="line"><span class="comment">        at Test234.main(Test234.java:5)</span></span><br><span class="line"><span class="comment">Caught: java.lang.RuntimeException: java.lang.Exception</span></span><br><span class="line"><span class="comment">java.lang.RuntimeException: java.lang.Exception</span></span><br><span class="line"><span class="comment">        at Test234.main(Test234.java:9)</span></span><br><span class="line"><span class="comment">Caused by: java.lang.Exception</span></span><br><span class="line"><span class="comment">        at Test234.main(Test234.java:5)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="6-Java标准异常"><a href="#6-Java标准异常" class="headerlink" title="6. Java标准异常"></a>6. Java标准异常</h3><p>Throwable这个Java类用来表示任何可以作为异常抛出的类。Throwable对象可以分成两种类型：Error用来表示编译时和系统错误：Exception是可以被抛出的基本类型。使用我们一般关心Exception类。<br><strong>特例：RuntimeException</strong><br>只能在代码中忽略RuntimeException（及其子类）类型的异常，其他类型异常的处理都是由编译器强制实施的。（简单说就是，异常声明只能忽略RuntimeException类和其子类，其他异常都必须说明）</p>
<hr>
<h3 id="7-异常的限制"><a href="#7-异常的限制" class="headerlink" title="7. 异常的限制"></a>7. 异常的限制</h3><p><strong>当覆盖方法时，只能抛出在基类方法的异常说明里列出的那些异常。</strong><a href="https://github.com/chaoxz2/Thinking-in-Java-4th-/blob/master/exercise/%E9%80%9A%E8%BF%87%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF/StormyInning.java">示例</a></p>
<ul>
<li>构造器：<br>父类构造器总会被子类构造器调用，所以<strong>子类构造器异常说明必须包含父类构造器的异常说明</strong>。</li>
<li>方法：<br>父类方法f()声明异常MyExceptionF，子类方法f()不抛出异常<br>父类方法g()声明异常MyExceptionG,子类方法g()抛出MyExceptionG的子类异常MyExceptionGA<br>父类方法h()未声明异常MyExceptionH,子类方法h()抛出异常MyExceptionH//！错误<br>子类新方法k()声明异常MyExceptionK</li>
<li>向上转型：<br>要求捕获基类（和自身独有的异常）。</li>
</ul>
<p>示例如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.goldfish666.util.Print.*;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyExceptionA</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyExceptionB</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyExceptionG</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyExceptionF</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyExceptionH</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyExceptionK</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyExceptionGA</span> <span class="keyword">extends</span> <span class="title">MyExceptionG</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Father</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Father</span><span class="params">()</span> <span class="keyword">throws</span> MyExceptionA</span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> <span class="keyword">throws</span> MyExceptionF</span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">g</span><span class="params">()</span> <span class="keyword">throws</span> MyExceptionG</span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">h</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Father</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Son</span><span class="params">()</span> <span class="keyword">throws</span> MyExceptionA,MyExceptionB</span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">g</span><span class="params">()</span> <span class="keyword">throws</span> MyExceptionGA</span>&#123;&#125;</span><br><span class="line">	<span class="comment">//!public static void h() throws MyExceptionH&#123;&#125;</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">k</span><span class="params">()</span> <span class="keyword">throws</span> MyExceptionK</span>&#123;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		<span class="comment">//方法</span></span><br><span class="line">		<span class="keyword">try</span>&#123;<span class="comment">//父类方法声明异常，子类方法不抛出</span></span><br><span class="line">			Son son=<span class="keyword">new</span> Son();</span><br><span class="line">			f();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionA e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionA"</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionB e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionB"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span>&#123;<span class="comment">//父类方法声明异常，子类方法抛出已声明异常的子类异常</span></span><br><span class="line">			Son son=<span class="keyword">new</span> Son();</span><br><span class="line">			g();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionA e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionA"</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionB e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionB"</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionGA e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionGA"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">try</span>&#123;<span class="comment">//父类方法不声明异常，子类方法抛出异常</span></span><br><span class="line">			Son son=<span class="keyword">new</span> Son();</span><br><span class="line">			h();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionA e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionA"</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionB e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionB"</span>);</span><br><span class="line">		&#125;<span class="comment">/*</span></span><br><span class="line"><span class="comment">		catch(MyExceptionH e)&#123;</span></span><br><span class="line"><span class="comment">			println("Caught MyExceptionH");</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		<span class="keyword">try</span>&#123;<span class="comment">//子类新方法抛出异常</span></span><br><span class="line">			Son son=<span class="keyword">new</span> Son();</span><br><span class="line">			k();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionA e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionA"</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionB e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionB"</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionK e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionK"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//向上转型</span></span><br><span class="line">		<span class="keyword">try</span>&#123;<span class="comment">//父类方法声明异常，子类方法不抛出</span></span><br><span class="line">			Father son=<span class="keyword">new</span> Son();</span><br><span class="line">			f();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionA e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionA"</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionB e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionB"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span>&#123;<span class="comment">//父类方法声明异常，子类方法抛出已声明异常的子类异常</span></span><br><span class="line">			Father son=<span class="keyword">new</span> Son();</span><br><span class="line">			g();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionA e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionA"</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionB e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionB"</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionG e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionGA"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">try</span>&#123;<span class="comment">//父类方法不声明异常，子类方法抛出异常</span></span><br><span class="line">			Father son=<span class="keyword">new</span> Son();</span><br><span class="line">			h();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionA e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionA"</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionB e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionB"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/*catch(MyExceptionH e)&#123;</span></span><br><span class="line"><span class="comment">			println("Caught MyExceptionH");</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		<span class="keyword">try</span>&#123;<span class="comment">//子类新方法抛出异常</span></span><br><span class="line">			Father son=<span class="keyword">new</span> Son();</span><br><span class="line">			k();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionA e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionA"</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionB e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionB"</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(MyExceptionK e)&#123;</span><br><span class="line">			println(<span class="string">"Caught MyExceptionK"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="8-构造器"><a href="#8-构造器" class="headerlink" title="8. 构造器"></a>8. 构造器</h3><p>主要是构造过程中出现异常的处理，如果构造器在执行过程中半途而废，也许该对象的某些部分还没有被成功的创建，而这些部分在finally子句中却是要被清理的。<br><strong>对于在构造阶段可能会抛出异常，并且要求清理的类，最安全的使用方式是使用嵌套的try子句</strong><br>例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConstractionException</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DisposeException</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Te</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Te</span><span class="params">()</span></span>&#123;<span class="comment">//构造器不会抛出异常</span></span><br><span class="line">		<span class="keyword">this</span>.id=counter++;</span><br><span class="line">		System.out.println(<span class="string">"Te Constructor "</span>+id);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispose</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Te "</span>+id+<span class="string">" disposed"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ae</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> counter=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> id;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Ae</span><span class="params">()</span> <span class="keyword">throws</span> ConstractionException</span>&#123;<span class="comment">//构造器可能会抛出异常</span></span><br><span class="line">		<span class="keyword">this</span>.id=counter++;</span><br><span class="line">		System.out.println(<span class="string">"Ae Constructor "</span>+id);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Good Job"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispose</span><span class="params">()</span><span class="keyword">throws</span> DisposeException</span>&#123;<span class="comment">//清理方法可能抛出异常</span></span><br><span class="line">		System.out.println(<span class="string">"Ae "</span>+id+<span class="string">" disposed"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dplay</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Ae "</span>+id+<span class="string">" dplay in finally"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test24</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line"><span class="comment">//构造器和清理方法都不会抛出异常：</span></span><br><span class="line">		Te te1=<span class="keyword">new</span> Te();</span><br><span class="line">		Te te2=<span class="keyword">new</span> Te();</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			te2.dispose();</span><br><span class="line">			te1.dispose();</span><br><span class="line">		&#125;</span><br><span class="line"><span class="comment">//构造器和清理方法可能抛出异常：</span></span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			Ae ae=<span class="keyword">new</span> Ae();</span><br><span class="line">			<span class="keyword">try</span>&#123;</span><br><span class="line">				</span><br><span class="line">			&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">				<span class="keyword">try</span>&#123;</span><br><span class="line">					ae.play();</span><br><span class="line">					<span class="comment">//ae.dispose();1</span></span><br><span class="line">					<span class="comment">//throw new DisposeException(); 2</span></span><br><span class="line">				&#125;<span class="keyword">catch</span>(DisposeException e)&#123;</span><br><span class="line">					System.out.println(e);</span><br><span class="line">				&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">					ae.dplay();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">catch</span>(ConstractionException e)&#123;</span><br><span class="line">			System.out.println(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*有1无2（清理方法未抛出异常）：</span></span><br><span class="line"><span class="comment">Te Constructor 1</span></span><br><span class="line"><span class="comment">Te Constructor 2</span></span><br><span class="line"><span class="comment">Te 2 disposed</span></span><br><span class="line"><span class="comment">Te 1 disposed</span></span><br><span class="line"><span class="comment">Ae Constructor 1</span></span><br><span class="line"><span class="comment">Good Job</span></span><br><span class="line"><span class="comment">Ae 1 disposed</span></span><br><span class="line"><span class="comment">DisposeException</span></span><br><span class="line"><span class="comment">Ae 1 dplay in finally</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*有2无1（清理方法抛出异常）：</span></span><br><span class="line"><span class="comment">Te Constructor 1</span></span><br><span class="line"><span class="comment">Te Constructor 2</span></span><br><span class="line"><span class="comment">Te 2 disposed</span></span><br><span class="line"><span class="comment">Te 1 disposed</span></span><br><span class="line"><span class="comment">Ae Constructor 1</span></span><br><span class="line"><span class="comment">Good Job</span></span><br><span class="line"><span class="comment">Ae 1 dplay in finally</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>核心代码是嵌套的try块：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Construction</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Construction</span><span class="params">()</span> <span class="keyword">throws</span> ConstructionException</span>&#123;</span><br><span class="line">		<span class="comment">//...构造器描述</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> <span class="keyword">throws</span> MethodException</span>&#123;</span><br><span class="line">		<span class="comment">//...方法描述</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">disposeInFinally</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//...清理方法</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		<span class="keyword">try</span>&#123;<span class="comment">//外层try块，如果构造过程抛出异常跳到25行的异常处理程序</span></span><br><span class="line">			Construction con=<span class="keyword">new</span> Construction();</span><br><span class="line">			<span class="keyword">try</span>&#123;<span class="comment">//内层try块，在构造器成功完成构造后起作用</span></span><br><span class="line">				con.f();<span class="comment">//既是为了实现程序的目标，也是为了最后用finally清理</span></span><br><span class="line">			&#125;<span class="keyword">catch</span>(MethodException me)&#123;</span><br><span class="line">				<span class="comment">//...f()方法异常的异常处理程序</span></span><br><span class="line">			&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">					f.disposeInFinally();<span class="comment">//清理对象con</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">catch</span>(ConstructionException ce)&#123;</span><br><span class="line">			<span class="comment">//...构造器异常的异常处理程序</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>对于构造器可能抛出异常的构造过程，这样写可以应对所有情况：<br>如果构造过程没有抛出异常，那么就继续对创建的对象进行操作，然后在finally子句里进行清理；<br>如果构造过程抛出异常，那么程序会跳过之后的“对对象进行操作和清理”，直接转到构造器异常的异常处理程序。</p>
<hr>
<h3 id="9-异常匹配"><a href="#9-异常匹配" class="headerlink" title="9. 异常匹配"></a>9. 异常匹配</h3><p>抛出异常的时候，异常处理系统会按照代码的书写顺序找出“最近”的处理程序，找到匹配的处理程序之后，它就认为异常将得到处理，不再继续查找。（<strong>使用最近的匹配的异常处理程序处理异常</strong>）<br>查找的时候并不要要求抛出的异常同异常处理程序声明的异常完全匹配。派生类的对象也可以匹配其基类的处理程序。（<strong>不要求完全匹配，子类异常的对象可以被父类异常的异常处理程序捕获（匹配）</strong>）<br>例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExcepA</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExcepAA</span> <span class="keyword">extends</span> <span class="title">ExcepA</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExcepAAA</span> <span class="keyword">extends</span> <span class="title">ExcepAA</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span><span class="keyword">throws</span> ExcepA</span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> ExcepA();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AA</span> <span class="keyword">extends</span> <span class="title">A</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> <span class="keyword">throws</span> ExcepAA</span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> ExcepAA();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AAA</span> <span class="keyword">extends</span> <span class="title">AA</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> <span class="keyword">throws</span> ExcepAAA</span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> ExcepAAA();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		A a=<span class="keyword">new</span> AAA();<span class="comment">//AAA a=new AAA()也可以，不过编译会有警告</span></span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			a.play();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(ExcepAAA x)&#123;</span><br><span class="line">			System.out.println(<span class="string">"Caught ExcepAAA"</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(ExcepAA x)&#123;</span><br><span class="line">			System.out.println(<span class="string">"Caught ExcepAA"</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(ExcepA x)&#123;</span><br><span class="line">			System.out.println(<span class="string">"Caught ExcepA"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			a.play();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(ExcepAA x)&#123;</span><br><span class="line">			System.out.println(<span class="string">"Caught ExcepAA"</span>);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(ExcepA x)&#123;</span><br><span class="line">			System.out.println(<span class="string">"Caught ExcepA"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			a.play();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(ExcepA x)&#123;</span><br><span class="line">			System.out.println(<span class="string">"Caught ExcepA"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;<span class="comment">/*Output:</span></span><br><span class="line"><span class="comment">Caught ExcepAAA</span></span><br><span class="line"><span class="comment">Caught ExcepAA</span></span><br><span class="line"><span class="comment">Caught ExcepA</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="10-其他可选方式"><a href="#10-其他可选方式" class="headerlink" title="10. 其他可选方式"></a>10. 其他可选方式</h3><p>异常代表了当前方法不能继续执行的情况，开发异常处理的初衷是为了方便程序员处理错误。异常处理的一个重要原则是“只有在你知道如何处理的情况下才捕获异常”，实际上异常处理的一个重要目标就是<strong>把<em>错误处理的代码</em>和<em>错误发生的地点</em>相分离</strong>。<br>“被检查的异常”使这个问题变得有些复杂，它们强制你在没有准备好处理错误的时候加上catch子句，导致“harmful if swallowed”问题（无意间“吞食”了异常，导致异常丢失）。</p>
<h4 id="1-把异常传给控制台"><a href="#1-把异常传给控制台" class="headerlink" title="1. 把异常传给控制台"></a>1. 把异常传给控制台</h4><p>main()作为一个方法也可以有异常说明，声明可能抛出所有异常的父类Exception。通过把它传到控制台，就不必在main()里写try-catch子句了。例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExcepA</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Testlee0</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> <span class="keyword">throws</span> ExcepA</span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> ExcepA();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		f();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;<span class="comment">/*Output:</span></span><br><span class="line"><span class="comment">Exception in thread "main" ExcepA</span></span><br><span class="line"><span class="comment">        at Testlee0.f(Testlee0.java:4)</span></span><br><span class="line"><span class="comment">        at Testlee0.main(Testlee0.java:7)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<h4 id="2-把“被检查的异常”转换为“不检查的异常”"><a href="#2-把“被检查的异常”转换为“不检查的异常”" class="headerlink" title="2. 把“被检查的异常”转换为“不检查的异常”"></a>2. 把“被检查的异常”转换为“不检查的异常”</h4><p>从main()中抛出异常很方便，但是不是通用的方法，因为问题的实质是，当在一个普通方法里调用别的方法时，要考虑到“我不知道该怎么处理这个异常，但是也不想把它‘吞’了，或者打印一些无用的消息”。<br>异常链给了一种思路来解决这个问题：把“被检查的异常”包装进RuntimeException里，这样就<strong>不必进行异常说明，也不用担心异常丢失，异常链还保证不会丢失任何原始异常的信息。</strong></p>
<h5 id="1-对于系统自带的异常类："><a href="#1-对于系统自带的异常类：" class="headerlink" title="1. 对于系统自带的异常类："></a>1. 对于系统自带的异常类：</h5><ul>
<li>抛出异常，异常处理程序里以该异常为参数抛出RuntimeException()构建异常链；</li>
<li>捕获RuntimeException异常，在它的异常处理程序里使用<strong>getCause()</strong>方法抛出异常；</li>
<li>尝试捕捉该异常，进行处理。<br>例：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对于已有的异常类</span></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pack</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">throwRuntimeException</span><span class="params">(<span class="keyword">int</span> type)</span></span>&#123;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			<span class="keyword">switch</span>(type)&#123;</span><br><span class="line">				<span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">throw</span> <span class="keyword">new</span> IOException();</span><br><span class="line">				<span class="keyword">case</span> <span class="number">1</span>:<span class="keyword">throw</span> <span class="keyword">new</span> FileNotFoundException();</span><br><span class="line">				<span class="keyword">case</span> <span class="number">2</span>:<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Where am I"</span>);</span><br><span class="line">				<span class="keyword">default</span>:<span class="keyword">return</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		Pack pa=<span class="keyword">new</span> Pack();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)</span><br><span class="line">			<span class="keyword">try</span>&#123;</span><br><span class="line">				pa.throwRuntimeException(i);</span><br><span class="line">			&#125;<span class="keyword">catch</span>(RuntimeException re)&#123;</span><br><span class="line">				<span class="keyword">try</span>&#123;</span><br><span class="line">					<span class="keyword">throw</span> re.getCause();</span><br><span class="line">				&#125;<span class="keyword">catch</span>(FileNotFoundException e)&#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;<span class="keyword">catch</span>(IOException e)&#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;<span class="keyword">catch</span>(Throwable e)&#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">	&#125;</span><br><span class="line">&#125;<span class="comment">/*Output:</span></span><br><span class="line"><span class="comment">java.io.IOException</span></span><br><span class="line"><span class="comment">        at Pack.throwRuntimeException(Test.java:6)</span></span><br><span class="line"><span class="comment">        at Test.main(Test.java:21)</span></span><br><span class="line"><span class="comment">java.io.FileNotFoundException</span></span><br><span class="line"><span class="comment">        at Pack.throwRuntimeException(Test.java:7)</span></span><br><span class="line"><span class="comment">        at Test.main(Test.java:21)</span></span><br><span class="line"><span class="comment">java.lang.RuntimeException: Where am I</span></span><br><span class="line"><span class="comment">        at Pack.throwRuntimeException(Test.java:8)</span></span><br><span class="line"><span class="comment">        at Test.main(Test.java:21)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="2-对于自定义的异常类，让它继承自RuntimeException-甚至可以省去try-catch。"><a href="#2-对于自定义的异常类，让它继承自RuntimeException-甚至可以省去try-catch。" class="headerlink" title="2. 对于自定义的异常类，让它继承自RuntimeException,甚至可以省去try-catch。"></a>2. 对于自定义的异常类，让它继承自RuntimeException,甚至可以省去try-catch。</h5><p>例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">f</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> MyException();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">		f();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;<span class="comment">/*Output:</span></span><br><span class="line"><span class="comment">Exception in thread "main" MyException</span></span><br><span class="line"><span class="comment">        at Test.f(Test.java:5)</span></span><br><span class="line"><span class="comment">        at Test.main(Test.java:8)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>
    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        
        <li>
            <a target="_blank"  href="https://github.com/chaoxz2">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.xml"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


    <script>
        /**
         *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
         *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
        */
        if( '' || '')
        var disqus_config = function () {
            this.page.url = '';  // Replace PAGE_URL with your page's canonical URL variable
            this.page.identifier = ''; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        };

        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = 'https://goldfish666.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>



</html>
